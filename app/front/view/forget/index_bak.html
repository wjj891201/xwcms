<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <meta name="renderer" content="webkit">
        <title>忘记密码</title>
        <link rel="stylesheet" href="{__STATIC__}/assets/layui/css/layui.css">
        <link rel="stylesheet" href="{__STATIC__}/front/css/pintuer.css">
        <link rel="stylesheet" href="{__STATIC__}/front/css/admin.css">
        <script src="{__STATIC__}/front/js/jquery.js"></script>
        <script src="{__STATIC__}/assets/layui/layui.js"></script>
    </head>

    <body>
        <div class="container">
            <div class="line">
                <div class="xs6 xm4 xs3-move xm4-move">
                    <form class="layui-form" action="#" method="post" id="forget-form">
                        <div class="panel">
                            <div class="panel-head"><strong>忘记密码</strong></div>
                            <div class="panel-body" style="padding:30px;">
                                <div class="form-group">
                                    <div class="field field-icon-right">
                                        <input type="text" class="input" name="email" placeholder="Email" />
                                        <span class="icon icon-user"></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="field field-icon-right">
                                        <input type="text" class="input" name="email_captcha" placeholder="Email验证码" style="width:150px;display: inline-block;"/>
                                        <button class="button bg-main" id="receipt">获取</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="field field-icon-right">
                                        <input type="password" class="input" name="password" placeholder="密码" />
                                        <span class="icon icon-key"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-foot text-center"><button class="button button-block bg-main text-big" lay-submit="" lay-filter="forget">更改密码</button></div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </body>
    <script language="javascript">
        layui.use(['form'], function () {
            var $ = layui.$, layer = layui.layer, form = layui.form;
            $('#receipt').click(function () {
                var email = $("input[name='email']").val();
                var email_reg = /^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;
                if (!email || !email_reg.test(email)) {
                    layer.msg('请正确填写Email');
                    return false;
                } else {
                    $.ajax({
                        async: false,
                        type: 'post',
                        url: '/front/register/send_mail',
                        data: {email: email},
                        dataType: 'json',
                        success: function (res) {
                            if (res.code == 1) {
                                layer.msg(res.msg);
                            } else {
                                layer.msg(res.msg);
                                return false;
                            }
                        },
                        error: function (data) {
                            alert("操作失败");
                        }
                    });
                }
                return false;
            });

            form.on('submit(forget)', function (data) {
                data = data.field;
//                if (data.username == '') {
//                    layer.msg('用户名不能为空');
//                    return false;
//                }
//                if (data.password == '') {
//                    layer.msg('密码不能为空');
//                    return false;
//                }
//                if (data.repassword == '') {
//                    layer.msg('确认密码不能为空');
//                    return false;
//                }
//                if (data.captcha == '') {
//                    layer.msg('验证码不能为空');
//                    return false;
//                }
                $.ajax({
                    async: false,
                    type: 'post',
                    url: '/front/forget/index',
                    data: $('#forget-form').serialize(),
                    dataType: 'json',
                    success: function (res) {
                        if (res.code == 1) {
                            layer.msg('密码修改成功', function () {
                                window.location = '/front/login/index';
                            });
                        } else {
                            layer.msg(res.msg);
                            return false;
                        }
                    },
                    error: function (data) {
                        alert("添加失败");
                    }
                });
                return false;
            });
        });
    </script>
</html>
